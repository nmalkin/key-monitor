plugins {
    id "application"
    id "org.jetbrains.kotlin.jvm" version "1.1.2-2"
    id "org.junit.platform.gradle.plugin" version "1.0.0-M4"
}

repositories {
    mavenCentral()
    maven { url "http://dl.bintray.com/jetbrains/spek" }
}

sourceSets {
    main.kotlin.srcDirs += "test/main/kotlin"
}

junitPlatform {
    filters {
        engines {
            include "spek"
        }
    }
}

ext.junitJupiterVersion = "5.0.0-M4"

dependencies {
    compile "com.beust:jcommander:1.72"
    compile 'commons-validator:commons-validator:1.6'
    compile "org.jetbrains.kotlin:kotlin-stdlib-jre8"
    compile 'org.bouncycastle:bcprov-jdk15on:1.57'
    compile 'org.whispersystems:signal-service-android:2.5.10'
    testCompile "org.junit.jupiter:junit-jupiter-api:${junitJupiterVersion}"
    testCompile "org.jetbrains.kotlin:kotlin-test"
    testCompile "org.jetbrains.spek:spek-api:1.1.2"
    testRuntime "org.junit.jupiter:junit-jupiter-engine:${junitJupiterVersion}"
    testRuntime "org.jetbrains.spek:spek-junit-platform-engine:1.1.2"
}

mainClassName = 'KeyLookupKt'
applicationName = 'key-lookup'

task createExtraRunApp(type: CreateStartScripts) {
    mainClassName = "SignupTaskKt"
    classpath = startScripts.classpath
    outputDir = startScripts.outputDir
    applicationName = 'signup-task'
}

applicationDistribution.into("bin") {
    duplicatesStrategy = DuplicatesStrategy.EXCLUDE
    from(createExtraRunApp)
    fileMode = 0755
}